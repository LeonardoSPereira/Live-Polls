<h1 align="center">Live Polls</h1>

<div align="center">

[![Status](https://img.shields.io/badge/status-active-success.svg)]() <br><br>
[Portugu√™s](#pt) / [English](#en)
</div>

---
# Portugu√™s <a name = "pt"></a>

## üìù Tabela de conte√∫dos

- [Sobre](#about_pt)
- [Iniciando a aplica√ß√£o](#getting_started_pt)
- [Usando](#usage_pt)
- [Estrutura do projeto](#project_structure_pt)
- [Tecnologias](#built_using_pt)

## üßê Sobre <a name = "about_pt"></a>
Esse projeto tem como objetivo criar uma aplica√ß√£o de enquetes ao vivo, onde o usu√°rio pode criar enquetes, votar e ver os resultados em tempo real. <br />
Ele foi criado durante o Next Level Week Expert da Rocketseat, na trilha de NodeJS.<br />
Foram utilizadas as tecnologias de TypeScript, NodeJS, PostgreSQL, Prisma, WebSockets e outros.<br />
Para o sistema de vota√ß√£o em tempo real, foi utilizado o WebSockets, que permite a comunica√ß√£o em tempo real entre o servidor e o cliente, em integra√ß√£o com o Redis, que √© um banco de dados em mem√≥ria, para armazenar os resultados das vota√ß√µes.<br />
O sistema foi constru√≠do de forma a n√£o permitir que um usu√°rio vote mais de uma vez na mesma enquete, utilizando cookies para armazenar a informa√ß√£o de que o usu√°rio j√° votou naquela enquete. Caso o usu√°rio tente votar mais de uma vez na mesma op√ß√£o, o sistema n√£o aceitar√° o voto, mas caso o usu√°rio tente votar em outra op√ß√£o, o voto ser√° aceito e o anterior ser√° removido. 

## üèÅ Iniciando a aplica√ß√£o <a name = "getting_started_pt"></a>
Essas instru√ß√µes v√£o te permitir obter uma c√≥pia do projeto e rodar a aplica√ß√£o localmente para prop√≥sitos de desenvolvimento e teste.

### Pre-requisitos
- Primeiramente, √© necess√°rio ter o NodeJS instalado na m√°quina. Para isso, acesse o site oficial do NodeJS clicando [aqui](https://nodejs.org/) e siga as instru√ß√µes de instala√ß√£o para o seu sistema operacional.<br />
- Tamb√©m √© necess√°rio ter o Docker instalado na m√°quina. Para isso, acesse o site oficial do Docker clicando [aqui](https://www.docker.com/) e siga as instru√ß√µes de instala√ß√£o para o seu sistema operacional.<br />
- Al√©m disso, √© necess√°rio ter um aplicativo para testar requisi√ß√µes HTTP, que seja capaz de fazer requisi√ß√µes HTTP e requisi√ß√µes de WebSocket. Para isso, pode-se utilizar o Insomnia, Postman, Hoppscotch ou qualquer outro aplicativo de sua prefer√™ncia.


### Instala√ß√£o

1. Clone o reposit√≥rio por meio do comando ou baixe o arquivo .zip e extraia o conte√∫do:
```sh
git clone https://github.com/LeonardoSPereira/Live-Polls
```

2. Acesse a pasta do projeto

3. Instale as depend√™ncias do projeto
```sh
npm install
```

4. Rode o Docker para criar os containers do Postgres e do Redis
```sh
docker-compose up -d
```

5. Rode as migrations para criar as tabelas no banco de dados
```sh
npx prisma migrate dev
```

6. Rode o projeto
```sh
npm run dev
```

Para acessar o banco de dados PostgreSQL, o prisma possui um sistema de administra√ß√£o de banco de dados, que pode ser acessado por meio do seguinte comando:
```sh
npx prisma studio
```
com isso, ser√° aberto um navegador com a interface do prisma, onde √© poss√≠vel visualizar e editar os dados do banco de dados.

## üéà Usando <a name="usage_pt"></a>
Para usar a aplica√ß√£o, basta acessar o endere√ßo http://localhost:3333 por meio do seu aplicativo de requisi√ß√µes. A partir da√≠, √© poss√≠vel criar enquetes, votar e ver os resultados em tempo real.

### Rotas da aplica√ß√£o
- Cria√ß√£o de enquetes
  - M√©todo: POST
  - Rota: **/polls**
  - Corpo da requisi√ß√£o:
    ```json
    {
      "title": "T√≠tulo da enquete",
      "options": ["Op√ß√£o 1", "Op√ß√£o 2", "Op√ß√£o 3"]
    }
    ```
  - Exemplo de resposta:
    ```json
    {
      "message": "Poll created successfully",
      "poll": {
        "id": "id da enquete",
        "title": "T√≠tulo da enquete",
        "createdAt": "data de cria√ß√£o da enquete",
        "updatedAt": "data de atualiza√ß√£o da enquete"
      }
    }
    ```

- Listagem de √∫nica enquete
  - M√©todo: GET
  - Rota: **/polls/:pollId**
  - Par√¢metros da requisi√ß√£o:
    - pollId: id da enquete que pode ser obtido na cria√ß√£o da enquete ou via acesso aos dados no banco de dados
  - Corpo da requisi√ß√£o: N√£o √© necess√°rio
  - Exemplo de resposta:
    ```json
    {
      "poll": {
        "id": "id da enquete",
        "title": "T√≠tulo da enquete",
        "options": [
          {
            "id": "id da op√ß√£o",
            "title": "T√≠tulo da op√ß√£o",
            "votes": "quantidade de votos na op√ß√£o"
          },
          {
            "id": "id da op√ß√£o",
            "title": "T√≠tulo da op√ß√£o",
            "votes": "quantidade de votos na op√ß√£o"
          },
          {
            "id": "id da op√ß√£o",
            "title": "T√≠tulo da op√ß√£o",
            "votes": "quantidade de votos na op√ß√£o"
          }
        ]
      }
    }
    ```

- Vota√ß√£o em enquete
  - M√©todo: POST
  - Rota: **/polls/:pollId/votes**
  - Par√¢metros da requisi√ß√£o:
    - pollId: id da enquete que pode ser obtido na cria√ß√£o da enquete ou via acesso aos dados no banco de dados
  - Corpo da requisi√ß√£o:
    ```json
    {
      "pollOptionId": "id da op√ß√£o que o usu√°rio deseja votar"
    }
    ```
  - Exemplo de resposta:
    ```json
    {
      "message": "Vote registered successfully",
    }
    ```

- Request de WebSocket para atualiza√ß√£o em tempo real dos resultados
  - M√©todo: WebSocket
  - Rota: **/polls/:pollId/results**
  - Par√¢metros da requisi√ß√£o:
    - pollId: id da enquete que pode ser obtido na cria√ß√£o da enquete ou via acesso aos dados no banco de dados
  - Corpo da requisi√ß√£o: N√£o √© necess√°rio
  - A cada voto, o servidor enviar√° uma mensagem com os resultados atualizados para o cliente

## üìÅ Estrutura do projeto <a name = "project_structure_pt"></a>
A estrutura do projeto √© a seguinte:

```
‚îú‚îÄ‚îÄ prisma: pasta onde se encontram os arquivos de configura√ß√£o do prisma, juntamente com as migrations e os modelos do banco de dados.

‚îú‚îÄ‚îÄ src: pasta onde se encontram os arquivos da aplica√ß√£o.
‚îÇ   ‚îú‚îÄ‚îÄ http: pasta onde se encontram os arquivos relacionados √† API.

‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes: pasta onde se encontram os arquivos de rotas da aplica√ß√£o.
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create-polls.ts: arquivo de rota para cria√ß√£o de enquetes.
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ get-poll.ts: arquivo de rota para listagem de enquetes.
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ vote-on-poll.ts: arquivo de rota para vota√ß√£o em enquetes.

‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ws: pasta onde se encontram os arquivos relacionados ao WebSocket.
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ poll-results.ts: arquivo de WebSocket para atualiza√ß√£o em tempo real dos resultados das enquetes.

‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ server.ts: arquivo de configura√ß√£o do servidor.

‚îÇ   ‚îú‚îÄ‚îÄ lib: pasta onde se encontram os arquivos de configura√ß√£o e exporta√ß√£o de fun√ß√µes auxiliares.
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prisma.ts: arquivo de configura√ß√£o do prisma.
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ redis.ts: arquivo de configura√ß√£o do Redis.

‚îÇ   ‚îú‚îÄ‚îÄ utils: pasta onde se encontram os arquivos de fun√ß√µes auxiliares.
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ voting-pub-sub.ts: arquivo de configura√ß√£o do PubSub para atualiza√ß√£o em tempo real dos resultados das enquetes.
```

## ‚õèÔ∏è Tecnologias <a name = "built_using_pt"></a>
- [TypeScript](https://www.typescriptlang.org/) - Linguagem de programa√ß√£o
- [NodeJS](https://nodejs.org/) - Ambiente de execu√ß√£o
- [Fastify](https://www.fastify.io/) - Framework
- [Prisma](https://www.prisma.io/) - ORM
- [PostgreSQL](https://www.postgresql.org/) - Banco de dados
- [Redis](https://redis.io/) - Banco de dados em mem√≥ria
- [WebSockets](https://developer.mozilla.org/pt-BR/docs/Web/API/WebSockets) - Protocolo de comunica√ß√£o em tempo real
- [Docker](https://www.docker.com/) - Plataforma de containers
- [Zod](https://zod.dev) - Valida√ß√£o de dados para o TypeScript

---
# English <a name = "en"></a>

## üìù Table of Contents <a name = "en"></a>
- [About](#about_en)
- [Getting Started](#getting_started_en)
- [Usage](#usage_en)
- [Project Structure](#project_structure_en)
- [Technologies](#built_using_en)

## üßê About <a name = "about_en"></a>
This project aims to create a live polling application, where the user can create polls, vote and see the results in real time. <br />
It was created during the Next Level Week Expert by Rocketseat, in the NodeJS track.<br />
The technologies used were TypeScript, NodeJS, PostgreSQL, Prisma, WebSockets and others.<br />
For the real-time voting system, WebSockets were used, which allows real-time communication between the server and the client, integrated with Redis, which is an in-memory database, to store the results of the votes.<br />
The system was built in such a way that it does not allow a user to vote more than once in the same poll, using cookies to store the information that the user has already voted in that poll. If the user tries to vote more than once in the same option, the system will not accept the vote, but if the user tries to vote in another option, the vote will be accepted and the previous one will be removed.

## üèÅ Getting Started <a name = "getting_started_en"></a>
These instructions will allow you to get a copy of the project and run the application locally for development and testing purposes.

### Prerequisites
- First, you need to have NodeJS installed on your machine. To do this, access the official NodeJS website by clicking [here](https://nodejs.org/) and follow the installation instructions for your operating system.<br />
- You also need to have Docker installed on your machine. To do this, access the official Docker website by clicking [here](https://www.docker.com/) and follow the installation instructions for your operating system.<br />
- In addition, you need to have an application to test HTTP requests, which is capable of making HTTP requests and WebSocket requests. For this, you can use Insomnia, Postman, Hoppscotch or any other application of your choice.

### Installation
1. Clone the repository using the command or download the .zip file and extract the contents:
```sh
git clone https://github.com/LeonardoSPereira/Live-Polls
```

2. Access the project folder

3. Install the project dependencies
```sh
npm install
```

4. Run Docker to create the Postgres and Redis containers
```sh
docker-compose up -d
```

5. Run the migrations to create the tables in the database
```sh
npx prisma migrate dev
```

6. Run the project
```sh
npm run dev
```

To access the PostgreSQL database, prisma has a database administration system, which can be accessed through the following command:
```sh
npx prisma studio
```
with that, a browser will open with the prisma interface, where you can view and edit the database data.

## üéà Usage <a name="usage_en"></a>
To use the application, just access the address http://localhost:3333 through your request application. From there, you can create polls, vote and see the results in real time.

### Application routes
- Poll creation
  - Method: POST
  - Route: **/polls**
  - Request body:
    ```json
    {
      "title": "Poll title",
      "options": ["Option 1", "Option 2", "Option 3"]
    }
    ```
  - Example response:
    ```json
    {
      "message": "Poll created successfully",
      "poll": {
        "id": "poll id",
        "title": "Poll title",
        "createdAt": "poll creation date",
        "updatedAt": "poll update date"
      }
    }
    ```

- Single poll listing
  - Method: GET
  - Route: **/polls/:pollId**
  - Request parameters:
    - pollId: poll id that can be obtained when creating the poll or by accessing the data in the database
  - Request body: Not required
  - Example response:
    ```json
    {
      "poll": {
        "id": "poll id",
        "title": "Poll title",
        "options": [
          {
            "id": "option id",
            "title": "Option title",
            "votes": "number of votes in the option"
          },
          {
            "id": "option id",
            "title": "Option title",
            "votes": "number of votes in the option"
          },
          {
            "id": "option id",
            "title": "Option title",
            "votes": "number of votes in the option"
          }
        ]
      }
    }
    ```

- Poll voting
  - Method: POST
  - Route: **/polls/:pollId/votes**
  - Request parameters:
    - pollId: poll id that can be obtained when creating the poll or by accessing the data in the database
  - Request body:
    ```json
    {
      "pollOptionId": "id of the option the user wants to vote for"
    }
    ```
  - Example response:
    ```json
    {
      "message": "Vote registered successfully",
    }
    ```

- WebSocket request for real-time update of results
  - Method: WebSocket
  - Route: **/polls/:pollId/results**
  - Request parameters:
    - pollId: poll id that can be obtained when creating the poll or by accessing the data in the database
  - Request body: Not required
  - With each vote, the server will send a message with the updated results to the client


## üìÅ Project Structure <a name = "project_structure_en"></a>
The project structure is as follows:

```
‚îú‚îÄ‚îÄ prisma: folder where the prisma configuration files, migrations and database models are located.

‚îú‚îÄ‚îÄ src: folder where the application files are located.
‚îÇ   ‚îú‚îÄ‚îÄ http: folder where the files related to the API are located.

‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes: folder where the application routes files are located.
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create-polls.ts: route file for poll creation.
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ get-poll.ts: route file for poll listing.
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ vote-on-poll.ts: route file for poll voting.

‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ws: folder where the WebSocket files are located.
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ poll-results.ts: WebSocket file for real-time update of poll results.

‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ server.ts: server configuration file.

‚îÇ   ‚îú‚îÄ‚îÄ lib: folder where the configuration files and export of auxiliary functions are located.
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prisma.ts: prisma configuration file.
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ redis.ts: Redis configuration file.

‚îÇ   ‚îú‚îÄ‚îÄ utils: folder where the auxiliary functions files are located.
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ voting-pub-sub.ts: PubSub configuration file for real-time update of poll results.
```

## ‚õèÔ∏è Technologies <a name = "built_using_en"></a>
- [TypeScript](https://www.typescriptlang.org/) - Programming language
- [NodeJS](https://nodejs.org/) - Execution environment
- [Fastify](https://www.fastify.io/) - Framework
- [Prisma](https://www.prisma.io/) - ORM
- [PostgreSQL](https://www.postgresql.org/) - Database
- [Redis](https://redis.io/) - In-memory database
- [WebSockets](https://developer.mozilla.org/pt-BR/docs/Web/API/WebSockets) - Real-time communication protocol
- [Docker](https://www.docker.com/) - Containers platform
- [Zod](https://zod.dev) - Data validation for TypeScript
